<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[zphj1987'Blog]]></title>
  <subtitle><![CDATA[现在所学，终有所用]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://yoursite.com/"/>
  <updated>2015-03-20T10:01:18.487Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name><![CDATA[zphj1987]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[单独编译一个ext4模块]]></title>
    <link href="http://yoursite.com/2015/03/20/%E5%8D%95%E7%8B%AC%E7%BC%96%E8%AF%91%E4%B8%80%E4%B8%AAext4%E6%A8%A1%E5%9D%97/"/>
    <id>http://yoursite.com/2015/03/20/单独编译一个ext4模块/</id>
    <published>2015-03-20T09:49:26.000Z</published>
    <updated>2015-03-20T10:01:18.487Z</updated>
    <content type="html"><![CDATA[<p>当我们需要使用一个内核模块的时候,在当前使用版本内核编译的时候又没有加进去,在不改变内核版本的时候,再编译整个内核,可能会覆盖原来的内核,导致系统无法启动</p>
<p>现在我们能够单独选择需要的模块,然后加载进内核</p>
<h3 id="准备工作">准备工作</h3><p>首先进入你当前使用的系统查看当前的使用内核版本,在这里是 2.3.39</p>
<p>下载对应内核源码包 linux-2.6.39.tar.bz2 将源码包放入 /usr/src/ 下<br>解压源码包<br>更新编译工具包</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install bzip2 libncurses5-dev kernel-package zlib1g-dev gcc make kernel-package wget module-init-tools procps libncurses5-dev</span><br></pre></td></tr></table></figure>
<p>进入到你需要的模块的文件夹下面<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /usr/src/linux-<span class="number">2.6</span>.<span class="number">39</span>/fs/ext4/</span><br></pre></td></tr></table></figure></p>
<p>进入 Makefile 查看模块信息</p>
<p>编译模块<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ T02-APP205:/usr/src/linux-<span class="number">2.6</span>.<span class="number">39</span>/fs/ext4<span class="comment"># make CONFIG_EXT4_FS=m -C /lib/module s /`uname -r` / build M=`pwd` modules</span></span><br></pre></td></tr></table></figure></p>
<p>可能会报错</p>
<p>找不到编译的文件路径,做一个软连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ln <span class="operator">-s</span> /usr/src/linux-headers-<span class="number">2.6</span>.<span class="number">39</span>/ /lib/modules/<span class="number">2.6</span>.<span class="number">39</span>/build</span><br></pre></td></tr></table></figure>
<p>再做一次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make CONFIG_EXT4_FS=m -C /lib/module s /`uname -r` / build M=`<span class="built_in">pwd</span>` modules</span><br></pre></td></tr></table></figure>
<p>就生成了两个模块 ，将这两个模块拷到你的当前使用内核的模块的路径<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /lib/modules/<span class="number">2.6</span>.<span class="number">39</span>/kernel/fs/ext4</span><br><span class="line"></span><br><span class="line">$ T02-APP205:/usr/src/linux-<span class="number">2.6</span>.<span class="number">39</span>/fs/ext4<span class="comment"># cp ext4.mod.o /lib/modules/2.6.39/kernel/fs/ext4</span></span><br><span class="line"></span><br><span class="line">$ T02-APP205:/usr/src/linux-<span class="number">2.6</span>.<span class="number">39</span>/fs/ext4<span class="comment"># cp ext4.ko /lib/modules/2.6.39/kernel/fs/ext4</span></span><br><span class="line"></span><br><span class="line">$ T02-APP205:/usr/src/linux-<span class="number">2.6</span>.<span class="number">39</span>/fs/ext4<span class="comment"># depmod</span></span><br><span class="line"></span><br><span class="line">$ T02-APP205:/usr/src/linux-<span class="number">2.6</span>.<span class="number">39</span>/fs/ext4<span class="comment">#modprobe ext4</span></span><br></pre></td></tr></table></figure></p>
<p>就可以看到 ext4 模块了</p>
<hr>
<p>写于:2011年12月16日</p>
<h2 id="更新于:2015年03月20日">更新于:2015年03月20日</h2>]]></content>
    <summary type="html">
    <![CDATA[<p>当我们需要使用一个内核模块的时候,在当前使用版本内核编译的时候又没有加进去,在不改变内核版本的时候,再编译整个内核,可能会覆盖原来的内核,导致系统无法启动</p>
<p>现在我们能够单独选择需要的模块,然后加载进内核</p>
<h3 id="准备工作">准备工作</h3><p>首先进入你当前使用的系统查看当前的使用内核版本,在这里是 2.3.39</p>
<p>下载对应内核源码包 linux-2.6.39.tar.bz2 将源码包放入 /usr/src/ 下<br>解压源码包<br>更新编译工具包</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[Debian 64位内核升级步骤]]></title>
    <link href="http://yoursite.com/2015/03/20/Debian-64%E4%BD%8D%E5%86%85%E6%A0%B8%E5%8D%87%E7%BA%A7%E6%AD%A5%E9%AA%A4/"/>
    <id>http://yoursite.com/2015/03/20/Debian-64位内核升级步骤/</id>
    <published>2015-03-20T09:21:21.000Z</published>
    <updated>2015-03-20T10:02:26.312Z</updated>
    <content type="html"><![CDATA[<h3 id="安装相关依赖包">安装相关依赖包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install bzip2 libncurses5-dev kernel-package zlib1g-dev gcc make kernel-package wget module-init-tools procps libncurses5-dev</span><br></pre></td></tr></table></figure>
<h3 id="下载源码">下载源码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src</span><br><span class="line">wget http://www.kernel.org/pub/linux/kernel/v2.<span class="number">6</span>/linux-<span class="number">2.6</span>.<span class="number">35.9</span>.tar.bz2</span><br><span class="line">tar -xvjf linux-<span class="number">2.6</span>.<span class="number">35.9</span>.tar.bz2</span><br><span class="line">cp /boot/config-`uname -r` /usr/src/linux-<span class="number">2.6</span>.<span class="number">35.9</span>/.config</span><br><span class="line">Then we must configure the new kernel:</span><br><span class="line"><span class="built_in">cd</span> linux-<span class="number">2.6</span>.<span class="number">35.9</span></span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="裁剪不需要的东西">裁剪不需要的东西</h3><p>我们在内核配置里面至少有几个地方要修改。如下所示:</p>
<blockquote>
<p>File systems -&gt; Btrfs filesystem (EXPERIMENTAL) Unstable disk format<br>在”Btrfs filesystem”之前标上&lt;*&gt;<br>Processor type and features -&gt; Processor Family -&gt; “our processor”<br>删除Dell laptop support、Toshiba Laptop support。<br>裁减sound card support。<br>裁减Bluetooth subsystem support。<br>裁减Wireless。<br>裁减Kernel hacking 。<br>多次点击“ESC”退出,保存<br>make-kpkg linux-image linux-headers —initrd<br>编译成功后执行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ..</span><br><span class="line">$ dpkg -i linux-image-<span class="number">2.6</span>.<span class="number">29</span>_2.<span class="number">6.35</span>.<span class="number">9</span>-<span class="number">10.00</span>.Custom_i386.deb</span><br><span class="line">$ dpkg -i linux-headers-<span class="number">2.6</span>.<span class="number">29</span>_2.<span class="number">6.35</span>.<span class="number">9</span>-<span class="number">10.00</span>.Custom_i386.deb</span><br></pre></td></tr></table></figure>
<p>重启,用 uname-a 查看内核版本</p>
<h3 id="错误处理">错误处理</h3><p>编译完成后生成linux deb 包,先dpkg -i装image,再装headers</p>
<p>安装完成以后再update-grub 进入/boot/grub/menu.lst 中选择启动的内核项 默认的第一项为0</p>
<p>在编译完成内核后开机可能出现 Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(1,0)的错误 在/boot/grub/menu.lst中可以发现新加的内核可能是没有 initrd   /initrd.img-2.6.37.6 未生成的原因不明 可以手动生成<br>执行命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkinitramfs -o /boot/initrd.img-<span class="number">2.6</span>.<span class="number">34.10</span> <span class="number">2.6</span>.<span class="number">34.10</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>/boot/initrd.img-2.6.34.10是这个启动加载文件的生成路径<br>2.6.34.10是 /lib/modules/2.6.34.10</p>
</blockquote>
<p>然后update-grub 再启动新内核就没有问题了<br>卸载一个已经安装的内核包<br>debian卸载旧内核要先看看有哪些旧的内核,用命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dpkg --get-selections |grep linux</span><br></pre></td></tr></table></figure></p>
<p>如果你的内核是以kernel开头的就把上面的linux改成kernel,之后再用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dpkg --purge --force-remove-essential linux-image-XXX</span><br></pre></td></tr></table></figure>
<hr>
<p>写于  : 2011年12月16日<br>更新于: 2015年3月20日</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="安装相关依赖包">安装相关依赖包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install bzip2 libncurses5-dev kernel-package zlib1g-dev gcc make kernel-package wget module-init-tools procps libncurses5-dev</span><br></pre></td></tr></table></figure>
<h3 id="下载源码">下载源码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/src</span><br><span class="line">wget http://www.kernel.org/pub/linux/kernel/v2.<span class="number">6</span>/linux-<span class="number">2.6</span>.<span class="number">35.9</span>.tar.bz2</span><br><span class="line">tar -xvjf linux-<span class="number">2.6</span>.<span class="number">35.9</span>.tar.bz2</span><br><span class="line">cp /boot/config-`uname -r` /usr/src/linux-<span class="number">2.6</span>.<span class="number">35.9</span>/.config</span><br><span class="line">Then we must configure the new kernel:</span><br><span class="line"><span class="built_in">cd</span> linux-<span class="number">2.6</span>.<span class="number">35.9</span></span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[test1]]></title>
    <link href="http://yoursite.com/2015/03/19/test/"/>
    <id>http://yoursite.com/2015/03/19/test/</id>
    <published>2015-03-19T15:27:00.000Z</published>
    <updated>2015-03-20T08:53:32.778Z</updated>
    <content type="html"><![CDATA[<p>av<br>sd<br>sad<br>as<br>da<br>sd<br>as<br>da<br>sdasddddddddddddddddd</p>
<p>a</p>
<p>a<br>a</p>
<p>asdasd<br>as<br>d<br>asd<br>as<br>da</p>
<p>as<br>das<br>d<br>as</p>
<p>asds</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>av<br>sd<br>sad<br>as<br>da<br>sd<br>as<br>da<br>sdasddddddddddddddddd</p>
<p>a</p>
<p>a<br>a</p>
<p>asdasd<br>as<br>d<br>asd<br>as<br>da]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[the fist day]]></title>
    <link href="http://yoursite.com/2015/03/19/the-fist-day/"/>
    <id>http://yoursite.com/2015/03/19/the-fist-day/</id>
    <published>2015-03-19T14:54:59.000Z</published>
    <updated>2015-03-19T15:11:25.413Z</updated>
    <content type="html"><![CDATA[<h2 id="为什么写这个博客">为什么写这个博客</h2><p>博客转移了很多地方,从最开始的人人小站,到后来的CSDN,再到简书,换来换去直到看到还有个hexo,这个是搭建在github上的一个博客,只不过排版什么的可能需要自己来处理了,这个博客最大的优点就是简洁,可以很方便的找到自己需要了,打算用这个还有个原因是,看到了几个写的很好的技术文章正好来自这个平台,自己也尝试着把好东西都放到这里汇总</p>
<p>很多东西真的非常喜欢,比如goagent,比如google,比如github,以及一些其他的开源的东西,也许很多人无法理解share是个什么感觉</p>
<p>这个博客是我技术文章开始的地方,也是我和嘎嘎开始减肥的日子,也该活的有生气一些,准备数据化我们的减肥数据,也许这样更能激励自己</p>
<p>谷歌的十大信条:</p>
<pre><code>1、以用户为中心,其他一切自然水到渠成
2、专心将一件事做到极致
3、越快越好
4、网络上也讲民主
5、信息随时随地可得
6、赚钱不必作恶
7、信息无极限
8、信息需求无国界
9、认真不在着装
10、追求无止境
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<h2 id="为什么写这个博客">为什么写这个博客</h2><p>博客转移了很多地方,从最开始的人人小站,到后来的CSDN,再到简书,换来换去直到看到还有个hexo,这个是搭建在github上的一个博客,只不过排版什么的可能需要自己来处理了,这个博客最大的优点就是简洁,可以很方]]>
    </summary>
    
  </entry>
  
</feed>