<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>推荐一本书《Ceph设计原理与实现》 | zphj1987&#39;Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言本篇不是一篇技术文，而是推荐的一本书，对于写书来说，在多年以前觉得是一件可望而不可及的事情，而看到几本经典书籍的作者在讲述自己写书的过程的时候，都是自己注入了大量的精力的，所以我自己目前也只能是一个个知识点的以博客的方式进行记录
对于买书来说，很多人会觉得很贵，其实一本书几百面，只要里面的书有两面是能够帮助到你的，书的价值其实已经回来了，所以对于技术书籍来说，基本不评价书的好坏，而是去看多少能">
<meta property="og:type" content="article">
<meta property="og:title" content="推荐一本书《Ceph设计原理与实现》">
<meta property="og:url" content="http://www.zphj1987.com/2017/09/28/a-new-ceph-book/index.html">
<meta property="og:site_name" content="zphj1987'Blog">
<meta property="og:description" content="前言本篇不是一篇技术文，而是推荐的一本书，对于写书来说，在多年以前觉得是一件可望而不可及的事情，而看到几本经典书籍的作者在讲述自己写书的过程的时候，都是自己注入了大量的精力的，所以我自己目前也只能是一个个知识点的以博客的方式进行记录
对于买书来说，很多人会觉得很贵，其实一本书几百面，只要里面的书有两面是能够帮助到你的，书的价值其实已经回来了，所以对于技术书籍来说，基本不评价书的好坏，而是去看多少能">
<meta property="og:image" content="http://7xopdu.com1.z0.glb.clouddn.com/book-rocket.png">
<meta property="og:image" content="http://static.zybuluo.com/zphj1987/miyt9s24b9e9x2jzf8arkzzq/scancode.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="推荐一本书《Ceph设计原理与实现》">
<meta name="twitter:description" content="前言本篇不是一篇技术文，而是推荐的一本书，对于写书来说，在多年以前觉得是一件可望而不可及的事情，而看到几本经典书籍的作者在讲述自己写书的过程的时候，都是自己注入了大量的精力的，所以我自己目前也只能是一个个知识点的以博客的方式进行记录
对于买书来说，很多人会觉得很贵，其实一本书几百面，只要里面的书有两面是能够帮助到你的，书的价值其实已经回来了，所以对于技术书籍来说，基本不评价书的好坏，而是去看多少能">
  
    <link rel="alternative" href="/atom.xml" title="zphj1987&#39;Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xweck.com1.z0.glb.clouddn.com/logo/favicon.png">
  
  <link rel="stylesheet" href="http://7xweck.com1.z0.glb.clouddn.com/style.css" type="text/css">
   <link rel="stylesheet" href="http://7xweck.com1.z0.glb.clouddn.com/asciinema/asciinema-player.css" type="text/css">
   <link rel="stylesheet" href="http://7xweck.com1.z0.glb.clouddn.com/gitment.css">
   <script src="http://7xweck.com1.z0.glb.clouddn.com/gitment.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xweck.com1.z0.glb.clouddn.com/logo/favicon.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">zphj1987</a></h1>
		</hgroup>

		
		<p class="header-subtitle">止于至善</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/instagram">图片</a></li>
				        
							<li><a href="/payforask">打赏</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/zphj1987" title="github">github</a>
					        
								<a class="weibo" target="_blank" href=" http://weibo.com/zphj1987" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="http://www.zphj1987.com/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/ceph/" style="font-size: 20px;">ceph</a><a href="/tags/freebsd/" style="font-size: 10px;">freebsd</a><a href="/tags/instagram/" style="font-size: 10px;">instagram</a><a href="/tags/iptables/" style="font-size: 10px;">iptables</a><a href="/tags/linux/" style="font-size: 18.57px;">linux</a><a href="/tags/momotan/" style="font-size: 10px;">momotan</a><a href="/tags/nginx/" style="font-size: 12.86px;">nginx</a><a href="/tags/samba/" style="font-size: 10px;">samba</a><a href="/tags/ubuntu/" style="font-size: 17.14px;">ubuntu</a><a href="/tags/windows/" style="font-size: 10px;">windows</a><a href="/tags/zabbix/" style="font-size: 10px;">zabbix</a><a href="/tags/其他/" style="font-size: 10px;">其他</a><a href="/tags/内核/" style="font-size: 12.86px;">内核</a><a href="/tags/操作系统/" style="font-size: 11.43px;">操作系统</a><a href="/tags/杂七杂八/" style="font-size: 14.29px;">杂七杂八</a><a href="/tags/注册码/" style="font-size: 10px;">注册码</a><a href="/tags/测试工具/" style="font-size: 11.43px;">测试工具</a><a href="/tags/监控/" style="font-size: 10px;">监控</a><a href="/tags/网卡/" style="font-size: 12.86px;">网卡</a><a href="/tags/脚本/" style="font-size: 15.71px;">脚本</a><a href="/tags/高可用/" style="font-size: 10px;">高可用</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">1987 武汉 存储行业 QQ:199383004 MAIL:zphj1987@gmail.com</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">zphj1987</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7xweck.com1.z0.glb.clouddn.com/logo/favicon.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">zphj1987</h1>
			</hgroup>
			
			<p class="header-subtitle">止于至善</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/instagram">图片</a></li>
		        
					<li><a href="/payforask">打赏</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/zphj1987" title="github">github</a>
			        
						<a class="weibo" target="_blank" href=" http://weibo.com/zphj1987" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="http://www.zphj1987.com/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-a-new-ceph-book" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/28/a-new-ceph-book/" class="article-date">
  	<time datetime="2017-09-28T14:23:47.000Z" itemprop="datePublished">2017-09-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      推荐一本书《Ceph设计原理与实现》
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ceph/">ceph</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <center><br><img src="http://7xopdu.com1.z0.glb.clouddn.com/book-rocket.png" alt=""><br></center>

<h2 id="前言">前言</h2><p>本篇不是一篇技术文，而是推荐的一本书，对于写书来说，在多年以前觉得是一件可望而不可及的事情，而看到几本经典书籍的作者在讲述自己写书的过程的时候，都是自己注入了大量的精力的，所以我自己目前也只能是一个个知识点的以博客的方式进行记录</p>
<p>对于买书来说，很多人会觉得很贵，其实一本书几百面，只要里面的书有两面是能够帮助到你的，书的价值其实已经回来了，所以对于技术书籍来说，基本不评价书的好坏，而是去看多少能提取的东西，多少未知的东西</p>
<p>ceph的书籍最初的起步也是国外的一个作者写的，社区进行翻译，社区自己也出了一本书，还有ZETTAKIT（泽塔云）的研发常涛也出了一本《Ceph源码分析》，这些都是很好的书籍，之前也都有推荐，这些书籍都是一线的研发在繁忙之中抽出空余的时间写下来的</p>
<p>本篇推荐的一篇是来自中兴的书籍，中兴也是国内ceph开发里面代码提交量很高的公司</p>
<p>目前没能拿到书籍，所以只能从目录来讲下本书会提供哪些相关的知识了<br><a id="more"></a></p>
<h2 id="书籍简介">书籍简介</h2><h3 id="straw及straw2相关内容">straw及straw2相关内容</h3><p>这个是ceph里面的crush算法的内容，straw2算法优化了再平衡的时候的数据迁移量，以及能提供更好的分布，让数据更平均，相关内容里面还讲了数据分布的相关知识，整个能解决的应该是数据平均分布相关的知识，让你的数据更加平衡</p>
<h3 id="BlueStore_相关内容">BlueStore 相关内容</h3><p>BlueStore 是Ceph Luminous版本作为默认存储的新型的底层存储，这个是用来替换掉linux下的底层的文件系统的，而实现的一个新型的文件系统，这个是为了带来一个更好的性能的提升的，目前是测试可用，生产慎用的情况，应该会越来越稳定的</p>
<h3 id="纠删码原理与overwrites支持">纠删码原理与overwrites支持</h3><p>纠删码是为了解决副本的空间占用的问题，用更少的空间损失来获取更大的安全性，相当于计算换空间，纠删这个在很久以前就接触过一个另外一套文件系统，使用场景个人觉得是冷数据比较合适，而如果性能足够好，计算能力足够强，也能支撑比较大的带宽的<br>在之前的版本当中，ec的启用必须启动缓冲池，需要副本缓冲池的缓冲池做一层转发，这个转发实际上意味着写放大，并且还会出现缓冲池下刷数据的时候性能急剧下降的问题<br>在新版本中加入了overwrites支持，这个现在新版的bluestore的已经支持数据直接写到ec存储池了，也就是无需缓冲了</p>
<h3 id="PG_读写流程与状态迁移详解">PG 读写流程与状态迁移详解</h3><p>PG在恢复过程中会有各种状态，什么情况下会出现什么状态，什么状态进行什么处理，什么情况下不能乱动，这些都是需要好好的了解PG状态再进行操作的，否则把PG状态弄坏了，意味着数据也就无法读取了</p>
<h3 id="存储服务质量QoS">存储服务质量QoS</h3><p>ceph里面一直没有qos这个，也就是对读写相关的限流，kernel rbd的场景下是可以用cgroup进行qos相关的控制的，其他场景就没有什么好的方法了,所以在比较新的版本里面引入了dmclock来进行限流的相关的控制，这个以后可以在恢复以及写入当中做更精准的控制了，qos也是商用存储里面必要的功能，所以说ceph在功能完善方面更进了一步，需求推动研发</p>
<h3 id="存储RBD">存储RBD</h3><p>这个讲了rbd相关的一些知识，结构和功能方面的</p>
<h3 id="对象存储网关RGW">对象存储网关RGW</h3><p>这个讲了对象存储方面的一些功能特性和相关的操作</p>
<h3 id="分布式文件系统_CephFS">分布式文件系统 CephFS</h3><p>这个讲了cephfs相关的一些知识，讲了负载均衡和故障恢复的相关内容，负载均衡是相对于多active mds的场景的，可以对目录进行mds的负载划分，把负载分摊到多个mds上面，这个在新版本已经可以使用了，并且目前已经是生产可用</p>
<h3 id="定时scrub">定时scrub</h3><p>scrub这个不要让默认触发，自己做相关的策略，指定时间一个个PG的去scrub就可以了，书中应该会提及相关的具体做法</p>
<h3 id="Full的紧急处理">Full的紧急处理</h3><p>这个是集群出现Full以后的紧急处理，对于full以后的情况，一般不要乱动，因为full以后，其他osd也会是快full的状态，并且还有backfill full的控制，所以需要比较精准的控制，相当于游戏里面的微操了，书中应该会系统的讲解</p>
<h3 id="快照在增量备份中的应用">快照在增量备份中的应用</h3><p>通过快照的方式可以进行增量的备份，从而减少备份的需要获取的数据量，这个之前也有介绍过</p>
<h3 id="异常watcher的处理">异常watcher的处理</h3><p>这个应该是通过黑名单的方式进行watcher的相关的处理，这个建议是先处理能处理的，最后无法处理的异常情况用黑名单处理，这个等书出来以后可以看到更详细的内容</p>
<h2 id="作者简介">作者简介</h2><p>谢型果<br>中兴通讯资深软件工程师，5年存储开发经验，精通本地文件系统ZFS和分布式存储系统Ceph。2014 年开始研究 Ceph，2015 年加入 Ceph 开源社区，目前是 Ceph 开源社区的 Ceph Member。</p>
<p>任焕文<br>中兴通讯高级软件工程师，有10余年研发经验，曾就职于浪潮和华为，擅长数据库、网络和存储相关技术。Ceph Member成员，现主要负责Ceph文件系统、NAS存储和分布式一致性方面的研发工作。</p>
<p>严　军<br>中兴通讯高级软件工程师，从事存储系统开发工作多年，熟悉DPDK开发框架；2015年加入Ceph开源项目，对分布式存储系统QoS有深入研究，目前是Ceph开源社区的积极贡献者。</p>
<p>罗润兵<br>华中科技大学微电子专业研究生，中兴通讯高级软件工程师，精通TCP/IP协议栈和分布式存储系统，2014年开始接触并参与Ceph开源项目，目前是Ceph开源社区的积极贡献者。</p>
<p>韦巧苗<br>中兴通讯高级软件工程师，擅长C/C++编程，有5年存储系统研发经验，对Ceph RGW模块有深入研究，同时在Cache技术及性能优化上也有丰富的经验。</p>
<p>骆科学<br>中兴通讯高级软件工程师，有5年存储产品相关开发经验，擅长虚拟化及存储相关技术，2016年于Ceph中国社区年终盛典中被评为“2016年度社区十佳贡献者”。<br>总结</p>
<p>从目录上面看书中的内容包含的方面很多，可以看到这些很多都是我之前在生产环境当中使用到了或者接触过的东西，所以可以很系统的把这些知识提取出来，这样可以更了解整个系统<br>购买地址：</p>
<blockquote>
<p><a href="http://item.jd.com/12196497.html" target="_blank" rel="external">http://item.jd.com/12196497.html</a></p>
</blockquote>
<p>或者扫描二维码购买</p>
<center><br><img src="http://static.zybuluo.com/zphj1987/miyt9s24b9e9x2jzf8arkzzq/scancode.png" alt=""><br></center>

<h2 id="变更记录">变更记录</h2><table>
<thead>
<tr>
<th style="text-align:center">Why</th>
<th style="text-align:center">Who</th>
<th style="text-align:center">When</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">创建</td>
<td style="text-align:center">武汉-运维-磨渣</td>
<td style="text-align:center">2017-09-28</td>
</tr>
<tr>
<td style="text-align:center">更正常涛的公司名称</td>
<td style="text-align:center">武汉-运维-磨渣</td>
<td style="text-align:center">2017-09-28</td>
</tr>
</tbody>
</table>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/09/27/lost-osdmap-recovery/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">掉电后osdmap丢失无法启动osd的解决方案</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>




<div id="gitment"></div>
<!-- 主页不要加载gitment -->

<script>
var gitment = new Gitment({
  owner: 'zphj1987',
  repo: 'zphj1987.github.io',
  oauth: {
    client_id: '49c219308dda9f350a13',
    client_secret: 'a4702b56d1d9a6720d1d34b835a692d60724b577',
  },
})
gitment.render('gitment')
</script>
 



    <!-- WY BEGIN -->
<div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
<script>
  var cloudTieConfig = {
    url: document.location.href, 
    sourceId: "",
    productKey: "e8565dbbfcc547bfacab81ca841c15d1",
    target: "cloud-tie-wrapper"
  };
</script>
<script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>
    <!-- WY END -->

</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 zphj1987   <SPAN id=span_dt_dt></SPAN>
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>

<SCRIPT language=javascript>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("3/19/2015 22:54:59");//这个日期是可以修改的
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());//其实仅仅改了这里
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=Math.floor(e_hrsold);
e_minsold=(e_hrsold-hrsold)*60;
minsold=Math.floor((e_hrsold-hrsold)*60);
seconds=Math.floor((e_minsold-minsold)*60);
span_dt_dt.innerHTML="博客已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
show_date_time();
</SCRIPT>
    </div>
    
  <link rel="stylesheet" href="http://7xweck.com1.z0.glb.clouddn.com/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: undefined,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true
	}
</script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?252ba55374ee0e63b03196973bb9b776";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script src="http://7xweck.com1.z0.glb.clouddn.com/js/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="http://7xweck.com1.z0.glb.clouddn.com/js/main.js" type="text/javascript"></script>
<script src="http://7xweck.com1.z0.glb.clouddn.com/asciinema/asciinema-player.js" type="text/javascript"></script>


  </div>
</body>
</html>